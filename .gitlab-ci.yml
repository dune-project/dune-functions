---
before_script:
  - duneci-install-module https://gitlab.dune-project.org/core/dune-common.git
  - duneci-install-module https://gitlab.dune-project.org/core/dune-geometry.git
  - duneci-install-module https://gitlab.dune-project.org/core/dune-localfunctions.git
  - duneci-install-module https://gitlab.dune-project.org/staging/dune-uggrid.git
  - duneci-install-module https://gitlab.dune-project.org/core/dune-grid.git
  - duneci-install-module https://gitlab.dune-project.org/core/dune-istl.git
  - duneci-install-module https://gitlab.dune-project.org/pdelab/dune-typetree.git

debian:9--gcc:
  image: duneci/base:9
  script:
  - dunecontrol --current --opts=/duneci/opts.gcc all
  - dunecontrol --current make build_tests
  - cd build-cmake; duneci-ctest

debian:9--clang:
  image: duneci/base:9
  script:
  - dunecontrol --current --opts=/duneci/opts.clang all
  - dunecontrol --current make build_tests
  - cd build-cmake; duneci-ctest
  allow_failure: true

debian:8--gcc:
  image: duneci/base:8
  script:
  - dunecontrol --current --opts=/duneci/opts.gcc all
  - dunecontrol --current make build_tests
  - cd build-cmake; duneci-ctest

debian:8--clang-3.8:
  image: duneci/base:8-backports
  script:
  - dunecontrol --current --opts=/duneci/opts.clang all
  - dunecontrol --current make build_tests
  - cd build-cmake; duneci-ctest
